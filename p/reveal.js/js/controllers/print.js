import{SLIDES_SELECTOR}from"../utils/constants.js";import{queryAll,createStyleSheet}from"../utils/util.js";export default class Print{constructor(e){this.Reveal=e}async setupPDF(){const e=this.Reveal.getConfig(),t=queryAll(this.Reveal.getRevealElement(),SLIDES_SELECTOR),i=e.slideNumber&&/all|print/i.test(e.showSlideNumber),s=this.Reveal.getComputedSlideSize(window.innerWidth,window.innerHeight),n=Math.floor(s.width*(1+e.margin)),a=Math.floor(s.height*(1+e.margin)),o=s.width,l=s.height;await new Promise(requestAnimationFrame),createStyleSheet("@page{size:"+n+"px "+a+"px; margin: 0px;}"),createStyleSheet(".reveal section>img, .reveal section>video, .reveal section>iframe{max-width: "+o+"px; max-height:"+l+"px}"),document.documentElement.classList.add("print-pdf"),document.body.style.width=n+"px",document.body.style.height=a+"px";const r=document.querySelector(".reveal-viewport");let d;if(r){const e=window.getComputedStyle(r);e&&e.background&&(d=e.background)}await new Promise(requestAnimationFrame),this.Reveal.layoutSlideContents(o,l),await new Promise(requestAnimationFrame);const c=t.map((e=>e.scrollHeight)),h=[],m=t[0].parentNode;let p=1;t.forEach((function(t,s){if(!1===t.classList.contains("stack")){let r=(n-o)/2,m=(a-l)/2;const u=c[s];let f=Math.max(Math.ceil(u/a),1);f=Math.min(f,e.pdfMaxPagesPerSlide),(1===f&&e.center||t.classList.contains("center"))&&(m=Math.max((a-u)/2,0));const g=document.createElement("div");if(h.push(g),g.className="pdf-page",g.style.height=(a+e.pdfPageHeightOffset)*f+"px",d&&(g.style.background=d),g.appendChild(t),t.style.left=r+"px",t.style.top=m+"px",t.style.width=o+"px",this.Reveal.slideContent.layout(t),t.slideBackgroundElement&&g.insertBefore(t.slideBackgroundElement,t),e.showNotes){const i=this.Reveal.getSlideNotes(t);if(i){const t=8,s="string"==typeof e.showNotes?e.showNotes:"inline",a=document.createElement("div");a.classList.add("speaker-notes"),a.classList.add("speaker-notes-pdf"),a.setAttribute("data-layout",s),a.innerHTML=i,"separate-page"===s?h.push(a):(a.style.left=t+"px",a.style.bottom=t+"px",a.style.width=n-2*t+"px",g.appendChild(a))}}if(i){const e=document.createElement("div");e.classList.add("slide-number"),e.classList.add("slide-number-pdf"),e.innerHTML=p++,g.appendChild(e)}if(e.pdfSeparateFragments){const e=this.Reveal.fragments.sort(g.querySelectorAll(".fragment"),!0);let t;e.forEach((function(e,s){t&&t.forEach((function(e){e.classList.remove("current-fragment")})),e.forEach((function(e){e.classList.add("visible","current-fragment")}),this);const n=g.cloneNode(!0);if(i){const e=s+1;n.querySelector(".slide-number-pdf").innerHTML+="."+e}h.push(n),t=e}),this),e.forEach((function(e){e.forEach((function(e){e.classList.remove("visible","current-fragment")}))}))}else queryAll(g,".fragment:not(.fade-out)").forEach((function(e){e.classList.add("visible")}))}}),this),await new Promise(requestAnimationFrame),h.forEach((e=>m.appendChild(e))),this.Reveal.slideContent.layout(this.Reveal.getSlidesElement()),this.Reveal.dispatchEvent({type:"pdf-ready"})}isPrintingPDF(){return/print-pdf/gi.test(window.location.search)}}