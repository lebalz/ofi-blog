"use strict";(self.webpackChunkofi_blog_versioned=self.webpackChunkofi_blog_versioned||[]).push([[27852],{27852:(t,e,i)=>{i.r(e),i.d(e,{default:()=>N});var s=i(96540);const o="quillEditor_NxYB",n="quillAnswer_J46I",r="monospace_usc_",l="disableToolbar_bRdP",a="saveIndicator_PFXL";var h=i(20053),d=i(36277),c=i(11795),u=i(30207);const p={fileTypes:{regex:/^image\/(gif|jpe?g|a?png|svg|webp|bmp|heic|heif)/i,accept:"image/*,image/heic,image/heif"},downscale:{maxWidth:1024,maxHeight:1024,imageType:"image/jpeg",keepImageTypes:void 0,ignoreImageTypes:void 0,imageQuality:.5}};async function m(t){const{maxWidth:e,maxHeight:i,keepImageTypes:s,ignoreImageTypes:o,imageQuality:n}=p.downscale;let{imageType:r}=p.downscale;const l=t.split(";")[0].split(":")[1],a=new Image;a.src=t,await new Promise((t=>{a.onload=()=>{t()}}));const[h,d]=function(t,e,i,s){if(i&&s&&t<=i&&e<=s)return[t,e];if(i&&t>i){const o=i,n=Math.floor(e/t*o);if(s&&n>s){const i=s;return[Math.floor(t/e*i),i]}return[o,n]}if(s&&e>s){const i=s;return[Math.floor(t/e*i),i]}return[e,t]}(a.width,a.height,e,i),c=document.createElement("canvas");c.width=h,c.height=d;const u=c.getContext("2d");if("image/jpeg"===r&&(u.fillStyle="#FFFFFF",u.fillRect(0,0,a.width,a.height)),o?.includes(l))return t;s?.includes(l)&&(r=l),u.drawImage(a,0,0,h,d);return c.toDataURL(r,n)}async function g(t){const e=new FileReader;let s;return s="image/heic"===t.type.toLowerCase()||"image/heif"===t.type.toLowerCase()?i.e(88816).then(i.t.bind(i,88816,23)).then((e=>e.default({blob:t,toType:"image/jpeg",quality:.9}))):Promise.resolve(t),s?s.then((t=>{const i=new Promise(((t,i)=>{e.addEventListener("load",(()=>{const s=e.result?.toString();s?t(s):i("could not convert file to base64")}),!1)}));return e.readAsDataURL(t),i})):Promise.reject("could not convert file to base64")}const y=async t=>{if(t.preventDefault(),document.caretRangeFromPoint){const e=document.getSelection(),i=document.caretRangeFromPoint(t.clientX,t.clientY);e&&i&&e.setBaseAndExtent(i.startContainer,i.startOffset,i.startContainer,i.startOffset)}const e=await async function(t){const e=t?.dataTransfer?.files;return e}(t),i=Array.from(e||[]).filter((t=>!!t.type.match(p.fileTypes.regex))),s=i?.[0];if(s){return await g(s)}const o=await async function(t){const e=t.dataTransfer?.getData("URL");if(e){return await(await fetch(e)).blob()}}(t);if(o){return await g(o)}};const f=async t=>{const e=Array.from(t?.clipboardData?.items||[]).filter((t=>!!t.type.match(p.fileTypes.regex)));if(!e.length)return;if(!e.filter((t=>"text/html"!==t.type)).length)return void console.log("handlePaste also detected html");t.preventDefault();const i=e.pop()?.getAsFile();if(!i)return;return await g(i)};var v=i(64467),b=i(74354),x=i.n(b);const A={modules:["DisplaySize","Toolbar","Resize"],overlayStyles:{position:"absolute",boxSizing:"border-box",border:"1px dashed #444"},handleStyles:{position:"absolute",height:"12px",width:"12px",backgroundColor:"white",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80"},displayStyles:{position:"absolute",font:"12px/1.0 Arial, Helvetica, sans-serif",padding:"4px 8px",textAlign:"center",backgroundColor:"white",color:"#333",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80",cursor:"default"},toolbarStyles:{position:"absolute",top:"-12px",right:"0",left:"0",height:"0",minWidth:"100px",font:"12px/1.0 Arial, Helvetica, sans-serif",textAlign:"center",color:"#333",boxSizing:"border-box",cursor:"default"},toolbarButtonStyles:{display:"inline-block",width:"24px",height:"24px",background:"white",border:"1px solid #999",verticalAlign:"middle"},toolbarButtonSvgStyles:{fill:"#444",stroke:"#444",strokeWidth:"2"}};var w=i(9165);class S{constructor(t){(0,v.A)(this,"options",void 0),(0,v.A)(this,"img",void 0),(0,v.A)(this,"overlay",void 0),(0,v.A)(this,"requestUpdate",void 0),(0,v.A)(this,"onCreate",(t=>{})),(0,v.A)(this,"onDestroy",(()=>{})),(0,v.A)(this,"onUpdate",(()=>{})),this.overlay=t.overlay,this.img=t.img,this.options=t.options,this.requestUpdate=t.onUpdate}}let E={},k={},C={},L={};class B extends S{constructor(){super(...arguments),(0,v.A)(this,"toolbar",void 0),(0,v.A)(this,"alignments",void 0),(0,v.A)(this,"onCreate",(()=>{window&&window.Quill&&(E=window.Quill.import("parchment"),k=new E.Attributor.Style("float","float"),C=new E.Attributor.Style("margin","margin"),L=new E.Attributor.Style("display","display")),this.toolbar=document.createElement("div"),Object.assign(this.toolbar.style,this.options.toolbarStyles),this.overlay.appendChild(this.toolbar),this._defineAlignments(),this._addToolbarButtons()})),(0,v.A)(this,"onDestroy",(()=>{})),(0,v.A)(this,"onUpdate",(()=>{})),(0,v.A)(this,"_defineAlignments",(()=>{this.alignments=[{icon:w.mdiFormatAlignLeft,apply:()=>{L.add(this.img,"inline"),k.add(this.img,"left"),C.add(this.img,"0 1em 1em 0")},isApplied:()=>"left"==k.value(this.img)},{icon:w.mdiFormatAlignCenter,apply:()=>{L.add(this.img,"block"),k.remove(this.img),C.add(this.img,"auto")},isApplied:()=>"auto"==C.value(this.img)},{icon:w.mdiFormatAlignRight,apply:()=>{L.add(this.img,"inline"),k.add(this.img,"right"),C.add(this.img,"0 0 1em 1em")},isApplied:()=>"right"==k.value(this.img)}]})),(0,v.A)(this,"_addToolbarButtons",(()=>{const t=[];this.alignments.forEach(((e,i)=>{const s=document.createElement("span");t.push(s),s.innerHTML=((t,e)=>{const i=Number(e?.size)?`${e.size}rem`:e?.size||"1rem";return`<svg viewBox="0 0 24 24" role="presentation" class="${e?.className||""}" style="width: ${i}; height: ${i};"><path d="${t}" style="fill: currentcolor;"></path></svg>`})(e.icon,{size:"20px"}),s.addEventListener("click",(()=>{t.forEach((t=>t.style.filter="")),e.isApplied()?(k.remove(this.img),C.remove(this.img),L.remove(this.img)):(this._selectButton(s),e.apply()),this.requestUpdate()})),Object.assign(s.style,this.options.toolbarButtonStyles),i>0&&(s.style.borderLeftWidth="0"),e.isApplied()&&this._selectButton(s),this.toolbar.appendChild(s)}))})),(0,v.A)(this,"_selectButton",(t=>{t.style.filter="invert(20%)"}))}}class M extends S{constructor(){super(...arguments),(0,v.A)(this,"boxes",void 0),(0,v.A)(this,"dragBox",void 0),(0,v.A)(this,"dragStartX",void 0),(0,v.A)(this,"preDragWidth",void 0),(0,v.A)(this,"onCreate",(()=>{this.boxes=[],this.addBox("nwse-resize"),this.addBox("nesw-resize"),this.addBox("nwse-resize"),this.addBox("nesw-resize"),this.positionBoxes()})),(0,v.A)(this,"onDestroy",(()=>{this.setCursor("")})),(0,v.A)(this,"positionBoxes",(()=>{const t=-parseFloat(this.options.handleStyles.width)/2+"px",e=-parseFloat(this.options.handleStyles.height)/2+"px";[{left:t,top:e},{right:t,top:e},{right:t,bottom:e},{left:t,bottom:e}].forEach(((t,e)=>{Object.assign(this.boxes[e].style,t)}))})),(0,v.A)(this,"addBox",(t=>{const e=document.createElement("div");Object.assign(e.style,this.options.handleStyles),e.style.cursor=t,e.style.width=`${this.options.handleStyles.width}px`,e.style.height=`${this.options.handleStyles.height}px`,e.addEventListener("pointerdown",this.handleMousedown,!1),this.overlay.appendChild(e),this.boxes.push(e)})),(0,v.A)(this,"handleMousedown",(t=>{this.dragBox=t.target,this.dragStartX=t.clientX,this.preDragWidth=this.img.width||this.img.naturalWidth,this.setCursor(this.dragBox.style.cursor),document.body.style.touchAction="none",document.addEventListener("pointermove",this.handleDrag,!1),document.addEventListener("pointerup",this.handleMouseup,!1)})),(0,v.A)(this,"handleMouseup",(()=>{document.body.style.touchAction="auto",this.setCursor(""),document.removeEventListener("pointermove",this.handleDrag),document.removeEventListener("pointerup",this.handleMouseup)})),(0,v.A)(this,"handleDrag",(t=>{if(!this.img)return;const e=t.clientX-this.dragStartX;this.dragBox===this.boxes[0]||this.dragBox===this.boxes[3]?(this.img.width=Math.round(this.preDragWidth-e),this.img.style.width=`${Math.round(this.preDragWidth-e)}px`):(this.img.width=Math.round(this.preDragWidth+e),this.img.style.width=`${Math.round(this.preDragWidth+e)}px`),this.requestUpdate()})),(0,v.A)(this,"setCursor",(t=>{[document.body,this.img].forEach((e=>{e.style.cursor=t}))}))}}class T extends S{constructor(){super(...arguments),(0,v.A)(this,"display",void 0),(0,v.A)(this,"onCreate",(()=>{this.display=document.createElement("div"),Object.assign(this.display.style,this.options.displayStyles),this.overlay.appendChild(this.display)})),(0,v.A)(this,"onDestroy",(()=>{})),(0,v.A)(this,"onUpdate",(()=>{if(!this.display||!this.img)return;const t=this.getCurrentSize();if(this.display.innerHTML=t.join(" &times; "),t[0]>120&&t[1]>30)Object.assign(this.display.style,{right:"4px",bottom:"4px",left:"auto"});else if("right"==this.img.style.float){const t=this.display.getBoundingClientRect();Object.assign(this.display.style,{right:"auto",bottom:`-${t.height+4}px`,left:`-${t.width+4}px`})}else{const t=this.display.getBoundingClientRect();Object.assign(this.display.style,{right:`-${t.width+4}px`,bottom:`-${t.height+4}px`,left:"auto"})}})),(0,v.A)(this,"getCurrentSize",(()=>[this.img.width,Math.round(this.img.width/this.img.naturalWidth*this.img.naturalHeight)]))}}class j{constructor(t,e){void 0===e&&(e={}),(0,v.A)(this,"quill",void 0),(0,v.A)(this,"options",void 0),(0,v.A)(this,"modules",void 0),(0,v.A)(this,"img",void 0),(0,v.A)(this,"overlay",void 0),(0,v.A)(this,"initializeModules",(()=>{this.removeModules(),this.modules=[new B(this)],this.modules.push(new T(this)),this.modules.push(new M(this)),this.modules.forEach((t=>{t.onCreate()})),this.onUpdate()})),(0,v.A)(this,"onUpdate",(()=>{this.repositionElements(),this.modules.forEach((t=>{t.onUpdate()}))})),(0,v.A)(this,"removeModules",(()=>{this.modules.forEach((t=>{t.onDestroy()})),this.modules=[]})),(0,v.A)(this,"handleClick",(t=>{if(t.target&&t.target.tagName&&"IMG"===t.target.tagName.toUpperCase()){if(this.img===t.target)return;this.img&&this.hide(),this.show(t.target)}else this.img&&this.hide()})),(0,v.A)(this,"show",(t=>{this.img=t,this.showOverlay(),this.initializeModules()})),(0,v.A)(this,"showOverlay",(()=>{this.overlay&&this.hideOverlay(),this.quill.setSelection(null),this.setUserSelect("none"),document.addEventListener("keyup",this.checkImage,!0),this.quill.root.addEventListener("input",this.checkImage,!0),this.overlay=document.createElement("div"),Object.assign(this.overlay.style,this.options.overlayStyles),this.quill.root.parentNode.appendChild(this.overlay),this.repositionElements()})),(0,v.A)(this,"hideOverlay",(()=>{this.overlay&&(this.quill.root.parentNode.removeChild(this.overlay),this.overlay=void 0,document.removeEventListener("keyup",this.checkImage),this.quill.root.removeEventListener("input",this.checkImage),this.setUserSelect(""))})),(0,v.A)(this,"repositionElements",(()=>{if(!this.overlay||!this.img)return;const t=this.quill.root.parentNode,e=this.img.getBoundingClientRect(),i=t.getBoundingClientRect();Object.assign(this.overlay.style,{left:`${e.left-i.left-1+t.scrollLeft}px`,top:`${e.top-i.top+t.scrollTop}px`,width:`${e.width}px`,height:`${e.height}px`})})),(0,v.A)(this,"hide",(()=>{this.hideOverlay(),this.removeModules(),this.img=void 0})),(0,v.A)(this,"setUserSelect",(t=>{["userSelect","mozUserSelect","webkitUserSelect","msUserSelect"].forEach((e=>{this.quill.root.style[e]=t,document.documentElement.style[e]=t}))})),(0,v.A)(this,"checkImage",(t=>{this.img&&(46!=t.keyCode&&8!=t.keyCode||window.Quill.find(this.img).deleteAt(0),this.hide())})),this.quill=t,this.options=x()({},e,A),document.execCommand("enableObjectResizing",!1,"false"),this.quill.root.addEventListener("click",this.handleClick,!1),this.quill.root.parentNode.style.position=this.quill.root.parentNode.style.position||"relative",this.modules=[]}}const q=[["bold","italic","underline"],[{header:[1,2,3,!1]}],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],["image"]],z=t=>{const e=[];if(t.bold||t.italic||t.underline){const i=[];t.bold&&i.push("bold"),t.italic&&i.push("italic"),t.underline&&i.push("underline"),e.push(i)}if(t.h1||t.h2||t.h3){const i=[];t.h1&&i.push(1),t.h2&&i.push(2),t.h3&&i.push(3),i.push(!1),e.push(i)}if(t.color||t.background){const i=[];t.color&&i.push({color:[]}),t.background&&i.push({background:[]}),e.push(i)}if(t.ul||t.ol){const i=[];t.ol&&i.push({list:"ordered"}),t.ul&&i.push({list:"bullet"}),e.push(i)}if(t.formula||t.image){const i=[];t.formula&&i.push("formula"),t.image&&i.push("image"),e.push(i)}return t.code&&e.push(["code-block"]),e},D=["bold","italic","underline","strike","align","list","indent","size","width","header","link","image","video","color","background","clean","code-block","indent","blockquote","script","code","style"];var R=i(83914),U=i(66188),O=i(27813),F=i(74848);const N=(0,d.PA)((t=>{const e=s.useRef(!1),{model:i}=t,d=s.useRef(null),[v,b]=s.useState(!1),[x,A]=s.useState(!1),[w,S]=s.useState(!1),[E,k]=s.useState(!1),C={toolbar:t.toolbar?z(t.toolbar):[...q,...z(t.toolbarAdd||{})],imageResize:{handleStyles:{borderRadius:"50%"}}},L=t.theme||"snow",B=t.placeholder||"\u270d\ufe0f Antwort...",{quill:M,quillRef:T,Quill:N}=(0,u.l)({theme:L,modules:C,formats:D,placeholder:B,bounds:d?.current});s.useEffect((()=>(e.current=!0,()=>{e.current=!1})),[]),s.useEffect((()=>{let t;const e=(0,O.mJ)((()=>i.saveService.state),((e,i)=>{"save"===i&&"done"===e&&(k(!0),t=setTimeout((()=>{k(!1),t=void 0}),1500))}));return()=>{t&&clearTimeout(t),e()}}),[i]),s.useEffect((()=>{if(d.current){const e=e=>{if(e.preventDefault(),"bubble"===t.theme)try{M.theme.tooltip.edit(),M.theme.tooltip.show()}catch(e){console.log(e)}};return d.current.addEventListener("contextmenu",e),()=>{d.current&&d.current.removeEventListener("contextmenu",e)}}}),[d,M]),s.useEffect((()=>{M&&M.on("text-change",((t,e,s)=>{i.setText(M.root.innerHTML)}))}),[M]),s.useEffect((()=>{const e=t=>{t.preventDefault()};if(M){M.clipboard.dangerouslyPasteHTML(i.text||""),M.blur(),t.readonly&&M.disable(),M.getModule("toolbar").addHandler("image",_),M.root.addEventListener("drop",I),M.root.addEventListener("paste",W),M.getModule("toolbar").container.addEventListener("mousedown",e);const s=navigator.userAgent.includes("Mac");M.keyboard.addBinding({key:"s",metaKey:s,ctrlKey:!s},(()=>i.saveService.saveNow())),b(!0)}return()=>{M&&M.getModule("toolbar").container.removeEventListener("mousedown",e)}}),[M]);const $=async t=>{if(!t)return S(!1);m(t).then((t=>{(t=>{if(!e.current||!M)return;const i=M.getSelection(!0);M.insertEmbed(i.index,"image",t),i.index++,M.setSelection(i,"api"),M.insertText(i.index,"\n"),i.index++,M.setSelection(i,"api")})(t)})).catch((()=>{console.log("Could not insert image")})).finally((()=>{e.current&&S(!1)}))},_=()=>{const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",p.fileTypes.accept),t.click(),t.onchange=()=>{if(!t.files||t.files.length<1)return;const e=t.files[0];S(!0),g(e).then($)}},I=t=>{S(!0),y(t).then($)},W=t=>{S(!0),f(t).then($)};if(N&&!M){var P=N.import("formats/image");const t=["alt","height","width","style"];class e extends P{static formats(e){return t.reduce((function(t,i){return e.hasAttribute(i)&&(t[i]=e.getAttribute(i)),t}),{})}format(e,i){t.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}}N.register(e,!0),window.Quill=N,N.register("modules/imageResize",j,!0)}return(0,F.jsx)("div",{className:(0,h.default)(o,"notranslate"),onFocus:()=>!x&&A(!0),ref:d,children:(0,F.jsxs)("div",{className:(0,h.default)("quill-editor-container",n,t.monospace&&r,x?void 0:l),style:{display:v?void 0:"none",...t.style||{}},children:[(0,F.jsx)("div",{ref:T}),w&&(0,F.jsx)(c.A,{caption:"Bild Einf\xfcgen...",overlay:!0}),(0,F.jsxs)("span",{style:{minWidth:"1em"},className:a,children:["save"===i.saveService.state&&(0,F.jsx)(R.g,{icon:U.VNe,style:{color:"#3578e5"},spin:!0}),E&&(0,F.jsx)(R.g,{icon:U.SGM,style:{color:"var(--ifm-color-success)"}})]})]})})}))}}]);